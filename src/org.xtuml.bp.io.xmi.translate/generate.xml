<?xml version="1.0" encoding="UTF-8"?>
<project name="io.xmi.translate" default="all" basedir=".">

    <property name="ant-home-path" value="/home/tlondon/engineering/ides/BridgePoint/plugins/org.apache.ant_1.10.8.v20200515-1239" />
    <property name="mcj_path" value="../MC-Java" />
    <property name="eclipse.home" value="/home/tlondon/engineering/ides/BridgePoint" />
    <import file="${mcj_path}/common.xml" />

    <property name="plugins-home" value="${ant.home}/../.." />

    <property name="ooa.sql.input" value="../org.xtuml.bp.core/models/org.xtuml.bp.core/ooaofooa" />
    <property name="ooa.sql.output" value="sql/ooaofooa.sql" />

    <property name="graphics.sql.input" value="../org.xtuml.bp.ui.canvas/models/org.xtuml.bp.ui.canvas/ooaofgraphics" />
    <property name="graphics.sql.output" value="sql/ooaofgraphics.sql" />

    <target name="all" depends="ooa.sql, graphics.sql, generate_ooa_processors, generate_graphics_processors" />
    <target name="clean_all" depends="clean_sql, clean_processors" />

    <target name="ooa.sql.depends">
        <uptodate property="ooa.sql.buildNotNeeded" targetfile="sql/${ooa.sql.output}">
            <srcfiles dir="${ooa.sql.input}" excludes="${model_excludes}" includes="**/*.xtuml" />
        </uptodate>
    </target>

    <target name="graphics.sql.depends">
        <uptodate property="graphics.sql.buildNotNeeded" targetfile="sql/${graphics.sql.output}">
            <srcfiles dir="${graphics.sql.input}" excludes="${model_excludes}" includes="**/*.xtuml" />
        </uptodate>
    </target>

    <target name="ooa.sql" depends="ooa.sql.depends" description="Generate the sql version of the OoaofOoa model" unless="ooa.sql.buildNotNeeded">
        <echo>Generating ${ooa.sql.output} ...</echo>
        <copy file="../org.xtuml.bp.pkg/globals/Globals.xtuml" tofile="${ooa.sql.input}/Globals.xtuml" />
        <exec vmlauncher="false" failonerror="true" executable="${xtumlmc_build}">
            <arg line="xtumlmc_cleanse_for_BridgePoint ../org.xtuml.bp.core/models/org.xtuml.bp.core/ooaofooa sql/ooaofooa.sql" />
        </exec>
        <delete file="${ooa.sql.input}/Globals.xtuml" />
    </target>

    <target name="graphics.sql" depends="graphics.sql.depends" description="Generate the sql version of the Ooaofgraphisc model" unless="graphics.sql.buildNotNeeded">
        <echo>Generating ${graphics.sql.output} ...</echo>
        <copy file="../org.xtuml.bp.pkg/globals/Globals.xtuml" tofile="${graphics.sql.input}/Globals.xtuml" />
        <exec vmlauncher="false" failonerror="true" executable="${xtumlmc_build}">
            <arg line="xtumlmc_cleanse_for_BridgePoint ../org.xtuml.bp.ui.canvas/models/org.xtuml.bp.ui.canvas/ooaofgraphics sql/ooaofgraphics.sql" />
        </exec>
        <delete file="${graphics.sql.input}/Globals.xtuml" />
    </target>

    <property name="ooa.abstract.output" value="src/org/xtuml/bp/io/xmi/translate/processors/ModelClassAbstractProcessor.java" />

    <target name="generate_ooa_processors.depends">
        <uptodate property="ooa_processors.buildNotNeeded" targetfile="${ooa.abstract.output}">
            <srcfiles dir="sql" includes="${java.sql.dep}" />
            <srcfiles dir="arc" includes="*.arc" />
        </uptodate>
    </target>
    <target name="generate_ooa_processors" depends="generate_ooa_processors.depends" unless="ooa_processors.buildNotNeeded">
        <echo>Generating abstract xtuml processors</echo>
        <exec vmlauncher="false" failonerror="true" executable="${xtumlmc_build}">
            <env key="PTC_MC_ARC_DIR" value="${mcj_path}" />
            <env key="CHAIN_UTIL_DIR" value="${chain_util_path}" />
            <env key="XTUMLMC_HOME" value="${util_bin_dir}/../../" />
            <arg line="xtumlmc_gen_erate -qim -nopersist
          -import ${mcj_path}/ooa_schema.sql
          -import ${ooa.sql.output}
          -arch arc/generate_abstract_processors.arc
          -arch arc/generate_sql_processors.arc" />
        </exec>
    </target>

    <property name="graphics.abstract.output" value="src/org/xtuml/bp/io/xmi/translate/processors/GraphicalElementAbstractProcessor.java" />

    <target name="generate_graphics_processors.depends">
        <uptodate property="graphics_processors.buildNotNeeded" targetfile="${graphics.abstract.output}">
            <srcfiles dir="sql" includes="${java.sql.dep}" />
            <srcfiles dir="arc" includes="*.arc" />
        </uptodate>
    </target>
    <target name="generate_graphics_processors" depends="generate_graphics_processors.depends" unless="graphics_processors.buildNotNeeded">
        <echo>Generating abstract xtuml graphical processors</echo>
        <exec vmlauncher="false" failonerror="true" executable="${xtumlmc_build}">
            <env key="PTC_MC_ARC_DIR" value="${mcj_path}" />
            <env key="CHAIN_UTIL_DIR" value="${chain_util_path}" />
            <env key="XTUMLMC_HOME" value="${util_bin_dir}/../../" />
            <arg line="xtumlmc_gen_erate -qim -nopersist
          -import ${mcj_path}/ooa_schema.sql
          -import ${graphics.sql.output}
          -arch arc/generate_abstract_processors.arc
          -arch arc/generate_sql_processors.arc" />
        </exec>
    </target>

    <target name="clean_sql">
        <delete file="${ooa.sql.output}" />
    </target>

    <target name="clean_processors">
        <echo>Removing generated java source files ...</echo>
        <delete verbose="true">
            <fileset dir="src/main/java/org/xtuml/bp/io/xmi/translate/processors/generated" includes="**/*.java" />
            <fileset dir="src/main/java/org/xtuml/bp/io/xmi/translate/processors/generated/impl" includes="**/*.java" />
        </delete>
    </target>
</project>
